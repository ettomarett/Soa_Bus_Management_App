# Production Docker Compose with Traefik labels
# Run: docker-compose -f docker-compose.production.yml up -d

services:
  # API Gateway with Traefik labels
  api-gateway:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.api-gateway.rule=Host(`nassar.clueleak.com`) && PathPrefix(`/api/v1`)"
      - "traefik.http.routers.api-gateway.entrypoints=websecure"
      - "traefik.http.routers.api-gateway.tls.certresolver=letsencrypt"
      - "traefik.http.routers.api-gateway.priority=10"
      - "traefik.http.services.api-gateway.loadbalancer.server.port=8080"
      - "traefik.docker.network=traefik-network"
    environment:
      SPRING_REDIS_HOST: redis-server  # Use container name instead of service name
    networks:
      - microservices-network
      - traefik-network

  # Frontend with Traefik labels
  frontend:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.frontend.rule=Host(`nassar.clueleak.com`)"
      - "traefik.http.routers.frontend.entrypoints=websecure"
      - "traefik.http.routers.frontend.tls.certresolver=letsencrypt"
      - "traefik.http.services.frontend.loadbalancer.server.port=80"
      - "traefik.docker.network=traefik-network"
      # Priority for frontend to catch all routes not matching /api/v1
      - "traefik.http.routers.frontend.priority=1"
    networks:
      - microservices-network
      - traefik-network

networks:
  microservices-network:
    external: true
  traefik-network:
    external: true

